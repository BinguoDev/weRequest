/*!
 * weRequest 2.0.1
 * https://github.com/IvinWu/weRequest
 */
module.exports=function(t){var e={};function u(n){if(e[n])return e[n].exports;var r=e[n]={i:n,l:!1,exports:{}};return t[n].call(r.exports,r,r.exports,u),r.l=!0,r.exports}return u.m=t,u.c=e,u.d=function(t,e,n){u.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},u.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},u.t=function(t,e){if(1&e&&(t=u(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)u.d(n,r,function(e){return t[e]}.bind(null,r));return n},u.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return u.d(e,"a",e),e},u.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},u.p="",u(u.s=10)}([function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.default={sessionName:"session",codeName:"code",loginTrigger:function(){return!1},getSession:function(t){return t},successTrigger:function(){return!0},urlPerfix:"",successData:function(t){return t},doNotCheckSession:!1,errorTitle:"操作失败",errorContent:function(t){return t},reLoginLimit:3,errorCallback:null,reportCGI:!1,mockJson:!1,globalData:!1,sessionExpireKey:"sessionExpireKey"}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={session:"",sessionExpire:1/0,code:""}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(1),r=u(0),o=u(4),i=u(5),f=null;function l(){return new Promise(function(t,e){return!n.default.session&&!n.default.code||r.default.sessionExpireTime&&(new Date).getTime()>n.default.sessionExpire&&(d(),1)?(r.default.doNotCheckSession=!0,a().then(function(){return t()},function(t){return e(t)})):t()})}var c=null;function a(){return c||(c=new Promise(function(t,e){new Promise(function(t,e){console.log("wx.login");var u=(new Date).getTime();wx.login({success:function(u){return u.code?(n.default.code=u.code,t(u.code)):e({title:"登录失败",content:"请稍后重试[code 获取失败]"})},complete:function(){var t=(new Date).getTime();i.default.report("wx_login",u,t)},fail:function(t){return e({title:"登录失败",content:t.errMsg})}})}).then(function(){return c=null,t()}).catch(function(t){return c=null,e(t)})})),c}function d(){n.default.session="",wx.removeStorage({key:r.default.sessionName}),r.default.sessionExpireTime&&r.default.sessionExpireKey&&(n.default.sessionExpire=1/0,wx.removeStorage({key:r.default.sessionExpireKey}))}e.default={main:function(){return new Promise(function(t,e){return l().then(function(){return r.default.doNotCheckSession?Promise.resolve():(f||(f=new Promise(function(t,e){console.log("wx.checkSession()");var u=(new Date).getTime();wx.checkSession({success:function(){return t()},fail:function(){return d(),a().then(function(){return t()},function(t){return e(t)})},complete:function(){var t=(new Date).getTime();i.default.report("wx_checkSession",u,t)}})})),f)},function(t){var u=t.title,n=t.content;return o.default.doError(u,n),e({title:u,content:n})}).then(function(){return t()},function(t){var u=t.title,n=t.content;return o.default.doError(u,n),e({title:u,content:n})})})},setSession:function(t){n.default.session=t,r.default.doNotCheckSession=!0,r.default.sessionExpireTime&&r.default.sessionExpireKey&&(n.default.sessionExpire=(new Date).getTime()+r.default.sessionExpireTime,wx.setStorage({key:r.default.sessionExpireKey,data:String(n.default.sessionExpire)})),wx.setStorage({key:r.default.sessionName,data:n.default.session})},delSession:d}},function(t,e,u){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,u=1,n=arguments.length;u<n;u++)for(var r in e=arguments[u])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0});var r=u(7),o=u(0),i=u(1),f=u(12),l=u(9),c=u(2),a=u(8),d=u(5),s=u(13),p=u(4);function y(t){if(t.startsWith("http"))return t;var e=o.default.urlPerfix;return"function"==typeof o.default.urlPerfix&&(e=o.default.urlPerfix()),e+t}function m(t){return"function"==typeof t.beforeSend&&t.beforeSend(),void 0===t.reLoginCount?t.reLoginCount=0:t.reLoginCount++,t.showLoading&&r.default.show(t.showLoading),t.originUrl||(t.originUrl=t.url,t.url=y(t.url)),t}function v(){var t={};return"function"==typeof o.default.globalData?t=o.default.globalData():"object"==typeof o.default.globalData&&(t=o.default.globalData),t}function x(t){return t=function(t){var e,u,r,f;t.data||(t.data={});var l=i.default.code;i.default.code="",l?t.data=n({},t.data,((e={})[o.default.codeName]=l,e)):i.default.session&&(t.data=n({},t.data,((u={})[o.default.sessionName]=i.default.session,u)));var c=v();return t.data=n({},c,t.data),t.method=t.method||"GET",t.dataType=t.dataType||"json","GET"!==t.method&&(l?t.url=s.default.setParams(t.url,((r={})[o.default.codeName]=l,r)):i.default.session&&(t.url=s.default.setParams(t.url,((f={})[o.default.sessionName]=i.default.session,f))),t.url=s.default.setParams(t.url,c)),d.default.start(t),t}(t),new Promise(function(e,u){wx.request({url:t.url,data:t.data,method:t.method,header:t.header||{},dataType:t.dataType||"json",success:function(t){return e(t)},fail:function(e){return p.default.systemError(t,e),u(e)},complete:function(){"function"==typeof t.complete&&t.complete(),t.showLoading&&r.default.hide()}})})}function w(t){return t=function(t){var e,u,r,f;t.formData||(t.formData={});var l=i.default.code;i.default.code="",l?t.formData=n({},t.formData,((e={})[o.default.codeName]=l,e)):i.default.session&&(t.formData=n({},t.formData,((u={})[o.default.sessionName]=i.default.session,u)));var c=v();return t.formData=n({},c,t.formData),l?t.url=s.default.setParams(t.url,((r={})[o.default.codeName]=l,r)):i.default.session&&(t.url=s.default.setParams(t.url,((f={})[o.default.sessionName]=i.default.session,f))),t.url=s.default.setParams(t.url,c),d.default.start(t),t}(t),new Promise(function(e,u){wx.uploadFile({url:t.url,filePath:t.filePath||"",name:t.name||"",formData:t.formData,success:function(t){return e(t)},fail:function(e){return p.default.systemError(t,e),u(e)},complete:function(){"function"==typeof t.complete&&t.complete(),t.showLoading&&r.default.hide()}})})}e.default={format:y,request:function(t){return new Promise(function(e,u){if(t=m(t),o.default.mockJson){var n=f.default.get(t,"request");if(n)return e(n)}t.cache&&l.default.get(t),c.default.main().then(function(){return x(t)}).then(function(u){var n=a.default(u,t,"request");return e(n)}).catch(function(t){return u(t)})})},uploadFile:function(t){return new Promise(function(e,u){t=m(t),o.default.mockJson?f.default.get(t,"uploadFile"):c.default.main().then(function(){return w(t)}).then(function(u){var n=a.default(u,t,"uploadFile");return e(n)}).catch(function(t){return u(t)})})}}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(0);function r(t){var e="";if("function"==typeof n.default.errorTitle)try{e=n.default.errorTitle(t.data)}catch(t){}else"string"==typeof n.default.errorTitle&&(e=n.default.errorTitle);var u="";if("function"==typeof n.default.errorContent)try{u=n.default.errorContent(t.data)}catch(t){}else"string"==typeof n.default.errorContent&&(u=n.default.errorContent);return{title:e,content:u}}function o(t,e){wx.showModal({title:t,content:e||"网络或服务异常，请稍后重试",showCancel:!1})}e.default={systemError:function(t,e){"function"==typeof t.fail?t.fail(e):o("",e.errMsg)},logicError:function(t,e){if("function"==typeof t.fail)t.fail(e);else{var u=r(e);o(u.title,u.content)}"function"==typeof n.default.errorCallback&&n.default.errorCallback(t,e),console.error(e)},doError:o,getErrorMsg:r}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(0),r=u(6);function o(t,e,u){"function"==typeof n.default.reportCGI&&n.default.reportCGI(t,e,u,r.default)}e.default={start:function(t){t._reportStartTime=(new Date).getTime()},end:function(t){t._reportEndTime=(new Date).getTime(),t.report&&t._reportStartTime&&o(t.report,t._reportStartTime,t._reportEndTime)},report:o}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(3);e.default=function(t){return n.default.request(t)}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={show:function(t){wx.showToast({title:"boolean"==typeof t?"加载中":t,icon:"loading",mask:!0,duration:6e4})},hide:function(){wx.hideToast({})}}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(1),r=u(0),o=u(3),i=u(4),f=u(9),l=u(5),c=u(2);e.default=function(t,e,u){if(200===t.statusCode){if("string"==typeof t.data)try{t.data=JSON.parse(t.data)}catch(u){if(e.catchError)throw new Error(u);return void i.default.logicError(e,t)}if(l.default.end(e),r.default.loginTrigger(t.data)&&void 0!==e.reLoginCount&&e.reLoginCount<r.default.reLoginLimit)c.default.delSession(),"request"===u?o.default.request(e):"uploadFile"===u&&o.default.uploadFile(e);else if(r.default.successTrigger(t.data)){var a="";try{var d=r.default.getSession(t.data);d&&d!==n.default.session&&c.default.setSession(d)}catch(t){console.error("Function getSession occur error: "+t)}try{a=r.default.successData(t.data)}catch(t){console.error("Function successData occur error: "+t)}if(!e.noCacheFlash){if("function"!=typeof e.success)return a;e.success(a)}f.default.set(e,a)}else{if(e.catchError){var s=i.default.getErrorMsg(t);throw new Error(s.content)}i.default.logicError(e,t)}}else{if(e.catchError)throw new Error(t.statusCode.toString());i.default.logicError(e,t)}}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={get:function(t){t.originUrl&&wx.getStorage({key:t.originUrl,success:function(e){(!0===t.cache||"function"==typeof t.cache&&t.cache(e.data))&&"function"==typeof t.success&&t.success(e.data,{isCache:!0}),"function"==typeof t.complete&&t.complete()}})},set:function(t,e){t.originUrl&&(!0===t.cache||"function"==typeof t.cache&&t.cache(e))&&wx.setStorage({key:t.originUrl,data:e})}}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(11),r=u(6),o=u(14),i=u(15),f=u(16),l=u(17),c=u(18),a={init:n.default,request:r.default,uploadFile:o.default,setSession:i.default,login:f.default,getSession:l.default,getConfig:c.default};e.default=a},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(0),r=u(1);e.default=function(t){Object.assign(n.default,t);try{r.default.session=wx.getStorageSync(n.default.sessionName)||""}catch(t){console.error("wx.getStorageSync:fail, can not get session.")}try{r.default.sessionExpire=wx.getStorageSync(n.default.sessionExpireKey||"sessionExpireKey")||1/0}catch(t){console.error("wx.getStorageSync:fail, can not get sessionExpire.")}}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(0),r=u(7),o=u(8);e.default={get:function(t,e){if(!(n.default.mockJson[t.url]||t.originUrl&&n.default.mockJson[t.originUrl]))return console.error("mock 没有对应接口的数据"),!1;var u=n.default.mockJson[t.url]||(t.originUrl?n.default.mockJson[t.originUrl]:""),i={data:u=JSON.parse(JSON.stringify(u)),statusCode:200};return r.default.hide(),o.default(i,t,e)}}},function(t,e,u){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(t){for(var e,u=1,n=arguments.length;u<n;u++)for(var r in e=arguments[u])Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t}).apply(this,arguments)};Object.defineProperty(e,"__esModule",{value:!0}),e.default={setParams:function(t,e){void 0===t&&(t="");var u=t.indexOf("?"),r={};if(u>=0){var o=t.substr(u+1).split("&");o.forEach(function(t,e){var u=o[e].split("=");r[u[0]]=u[1]})}r=n({},r,e);var i=Object.keys(r).map(function(t){return t+"="+encodeURI(r[t])}).join("&");return u>=0?t.substring(0,u+1)+i:t+"?"+i}}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(3);e.default=function(t){return n.default.uploadFile(t)}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(2);e.default=function(t){n.default.setSession(t)}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(2);e.default=function(){return n.default.main()}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(1);e.default=function(){return n.default.session}},function(t,e,u){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=u(0),r=u(1);e.default=function(){return{urlPerfix:n.default.urlPerfix,sessionExpireTime:n.default.sessionExpireTime,sessionExpireKey:n.default.sessionExpireKey,sessionExpire:r.default.sessionExpire}}}]).default;